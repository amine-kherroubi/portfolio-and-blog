---
/**
 * FilterBar Component - WORKING & GENERIC
 *
 * Usage for ANY section:
 * <FilterBar tags={tags} type="writing" />
 * <FilterBar tags={tags} type="work" />
 * <FilterBar tags={tags} type="blog" />
 * <FilterBar tags={tags} type="anything-you-want" />
 */

import type { Tag } from "../config/tags";
import { sortTagsByCategory } from "../config/tags";

interface Props {
  tags: readonly Tag[];
  type: string; // ANY string - completely generic!
}

const { tags, type } = Astro.props;
const sortedTags = sortTagsByCategory(tags);
---

<div
  class="filter-bar border-b-2 border-black bg-white sticky top-20 z-40"
  role="search"
  aria-label="Filter content"
  data-filter-type={type}
>
  <div class="max-w-container mx-auto px-8 py-6">
    <div class="flex items-center gap-6 mb-6">
      <span
        class="text-sm font-bold uppercase tracking-[0.15em] text-black/50"
        id={`${type}-filter-label`}
      >
        Filter by:
      </span>
      <button
        id={`${type}-clear-filters`}
        class="text-sm font-bold uppercase tracking-[0.15em] hover:opacity-50 transition-opacity duration-200 hidden"
        aria-label="Clear all filters"
      >
        Clear All
      </button>
    </div>

    <div
      class="flex flex-wrap gap-2"
      id={`${type}-filter-tags`}
      role="group"
      aria-labelledby={`${type}-filter-label`}
    >
      {
        sortedTags.map((tag) => (
          <button
            class="filter-tag-btn focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-black focus-visible:ring-offset-2"
            data-tag-id={tag.id}
            data-type={type}
            aria-pressed="false"
            aria-label={`Filter by ${tag.label}`}
          >
            <span
              class="inline-block font-bold uppercase tracking-[0.15em] border-black transition-colors duration-200 text-sm px-5 py-2.5 border-2 bg-white text-black cursor-pointer hover:bg-black hover:text-white"
              data-tag-label={tag.label}
            >
              {tag.label}
            </span>
          </button>
        ))
      }
    </div>

    <div
      id={`${type}-results-count`}
      class="mt-6 text-sm text-black/60 font-bold uppercase tracking-[0.15em]"
      role="status"
      aria-live="polite"
      aria-atomic="true"
    >
    </div>
  </div>
</div>

<script>
  /**
   * Initialize filters when component loads
   * Uses data-filter-type attribute to get the type
   */
  import { initializeFilters } from "../scripts/filter.js";

  function initFilter() {
    // Get type from the filter bar element
    const filterBar = document.querySelector<HTMLElement>(
      ".filter-bar[data-filter-type]"
    );

    if (filterBar) {
      const type = filterBar.dataset["filterType"];

      if (type) {
        console.log(`[FilterBar] Initializing filters for type: ${type}`);
        initializeFilters(type);
      }
    }
  }

  // Initialize on page load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initFilter);
  } else {
    initFilter();
  }

  // Reinitialize on Astro navigation
  document.addEventListener("astro:page-load", initFilter);
</script>

<style>
  @media (prefers-reduced-motion: no-preference) {
    .filter-tag-btn span {
      transition:
        background-color 0.2s ease,
        color 0.2s ease;
    }
  }
</style>

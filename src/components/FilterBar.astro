---
/**
 * FilterBar Component
 * 
 * Filter bar for content filtering by tags.
 * Supports keyboard navigation and URL state management.
 */

import Tag from "./Tag.astro";
import type { Tag as TagType } from "../config/tags";
import { sortTagsByCategory } from "../config/tags";

interface Props {
  /** Available tags for filtering */
  tags: TagType[];
  /** Type of content being filtered */
  type: "writing" | "work";
}

const { tags, type } = Astro.props;
const sortedTags = sortTagsByCategory(tags);
---

<div
  class="filter-bar border-b-2 border-black bg-white/95 backdrop-blur-sm sticky top-20 md:top-24 z-40"
  role="search"
  aria-label="Filter content"
>
  <div
    class="max-w-container mx-auto px-8 md:px-16 lg:px-20 xl:px-32 py-6 md:py-8 lg:py-12"
  >
    <div
      class="flex flex-col sm:flex-row items-start sm:items-center gap-4 md:gap-6 mb-6 md:mb-8"
    >
      <span
        class="text-xs md:text-sm font-bold uppercase tracking-[0.15em] text-black/50"
        id={`${type}-filter-label`}
      >
        Filter by:
      </span>
      <button
        id={`${type}-clear-filters`}
        class="text-xs md:text-sm font-bold uppercase tracking-[0.15em] hover:opacity-50 transition-opacity duration-200 focus-visible:opacity-50 hidden"
        aria-label="Clear all filters"
      >
        Clear All
      </button>
    </div>

    <div
      class="flex flex-wrap gap-2 md:gap-3"
      id={`${type}-filter-tags`}
      role="group"
      aria-labelledby={`${type}-filter-label`}
    >
      {
        sortedTags.map((tag) => (
          <button
            class="filter-tag-btn focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-black focus-visible:ring-offset-2"
            data-tag-id={tag.id}
            data-type={type}
            aria-pressed="false"
            aria-label={`Filter by ${tag.label}`}
          >
            <span
              class="inline-block font-bold uppercase tracking-[0.15em] border-black transition-colors duration-200 text-xs md:text-sm px-4 md:px-5 py-2 md:py-2.5 border-2 bg-white text-black cursor-pointer hover:bg-black hover:text-white"
              data-tag-label={tag.label}
            >
              {tag.label}
            </span>
          </button>
        ))
      }
    </div>

    <div
      id={`${type}-results-count`}
      class="mt-6 md:mt-8 text-xs md:text-sm text-black/60 font-bold uppercase tracking-[0.15em]"
      role="status"
      aria-live="polite"
      aria-atomic="true"
    >
    </div>
  </div>
</div>

<script>
  /**
   * Filter Initialization
   * This script runs once per page load and initializes filters
   */
  
  // Wait for DOM to be fully loaded
  function initFilters() {
    // Import and initialize the filter module
    import("../scripts/filter.js").then(({ initializeFilters }) => {
      const path = window.location.pathname;
      if (path.includes("/writing")) {
        initializeFilters("writing");
      } else if (path.includes("/work")) {
        initializeFilters("work");
      }
    });
  }

  // Run on initial load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initFilters);
  } else {
    initFilters();
  }

  // Re-run on Astro page transitions
  document.addEventListener("astro:page-load", initFilters);
</script>

<style>
  /* Smooth animations */
  @media (prefers-reduced-motion: no-preference) {
    .filter-tag-btn span {
      transition:
        background-color 0.2s ease,
        color 0.2s ease;
    }

    [data-writing-item],
    [data-work-item] {
      transition: opacity 0.2s ease;
    }
  }

  /* Loading state */
  [data-writing-item][style*="display: none"],
  [data-work-item][style*="display: none"] {
    opacity: 0;
  }
</style>
---
/**
 * CardMetadata Component - Shared Metadata Display
 *
 * Purpose: Reusable component for displaying metadata like dates,
 * reading time, and other temporal information on cards.
 *
 * Self-contained: Handles all metadata patterns used across
 * BlogCard and ProjectCard with consistent styling.
 */

interface Props {
  date?: string;
  readTime?: string;
  year?: string;
  variant?: "featured" | "grid" | "list";
  class?: string;
}

const {
  date,
  readTime,
  year,
  variant = "featured",
  class: className = "",
} = Astro.props;

// Base classes based on variant
const variantClasses = {
  featured:
    "flex items-center gap-4 text-sm font-bold uppercase tracking-[0.15em] mb-6",
  grid: "flex items-center gap-4 text-sm font-bold uppercase tracking-[0.15em] mb-6",
  list: "col-span-2 text-[0.8125rem] font-bold uppercase tracking-[0.15em] opacity-60 group-hover:opacity-100 transition-opacity",
};

/**
 * Format ISO date string to simple date (YYYY-MM-DD) for display
 * Input: "2024-12-11T00:00:00.000Z"
 * Output: "2024-12-11"
 */
function formatDisplayDate(isoDateStr: string): string {
  try {
    // Extract just the date part from ISO string
    return isoDateStr.split("T")[0] || isoDateStr;
  } catch (error) {
    console.warn("[CardMetadata] Date formatting failed:", error);
    return isoDateStr;
  }
}

// Determine what to display
const primaryDisplay = date || year;
const displayDate = date ? formatDisplayDate(date) : undefined;
const secondaryDisplay = readTime;
const showSeparator = primaryDisplay && secondaryDisplay;
---

{
  primaryDisplay && (
    <div class:list={[variantClasses[variant], className]}>
      {displayDate && (
        <time datetime={date} itemprop="datePublished">
          {displayDate}
        </time>
      )}
      {year && !date && <span itemprop="dateCreated">{year}</span>}

      {showSeparator && variant !== "list" && (
        <span class="w-2 h-2 bg-black rounded-full" aria-hidden="true" />
      )}

      {readTime && variant !== "list" && (
        <span itemprop="timeRequired">{readTime}</span>
      )}
    </div>
  )
}

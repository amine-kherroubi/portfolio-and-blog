---
interface TimelineItem {
  year: string;
  title: string;
  company: string;
  description: string;
}

interface Props {
  items: TimelineItem[];
}

const { items } = Astro.props;
---

<section
  class="py-24 md:py-32 lg:py-48 px-8 md:px-16 lg:px-20 xl:px-32 border-t-2 border-black bg-gray-50"
>
  <div class="max-w-screen-2xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold mb-16 lg:mb-24 fade-in-up">
      Experience
    </h2>

    <div class="relative">
      <!-- Timeline line -->
      <div
        class="hidden lg:block absolute left-1/2 top-0 bottom-0 w-0.5 bg-black transform -translate-x-1/2 timeline-line"
        aria-hidden="true"
      >
      </div>

      <div class="space-y-12 lg:space-y-24">
        {
          items.map((item, index) => (
            <div class="timeline-item relative" data-index={index}>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16">
                {/* Left side (odd items) or empty space (even items) */}
                <div
                  class:list={[
                    index % 2 === 0 ? "lg:text-right" : "lg:order-2",
                  ]}
                >
                  <div class="timeline-content bg-white border-2 border-black p-6 lg:p-8 hover:border-4 transition-all duration-300 group">
                    <div class="flex lg:flex-col items-start lg:items-start gap-4 mb-4">
                      <div class="text-4xl lg:text-5xl font-bold group-hover:scale-110 transition-transform duration-300">
                        {item.year}
                      </div>
                    </div>

                    <h3 class="text-2xl lg:text-3xl font-bold mb-2 group-hover:underline decoration-2 underline-offset-4">
                      {item.title}
                    </h3>

                    <div class="text-sm font-bold uppercase tracking-widest text-black/60 mb-4">
                      {item.company}
                    </div>

                    <p class="text-lg leading-relaxed text-black/80">
                      {item.description}
                    </p>
                  </div>
                </div>

                {/* Timeline dot */}
                <div class="hidden lg:block absolute left-1/2 top-8 transform -translate-x-1/2">
                  <div class="timeline-dot w-6 h-6 bg-black border-4 border-white rounded-full" />
                </div>

                {/* Right side (even items) or empty space (odd items) */}
                {index % 2 !== 0 && <div class="hidden lg:block" />}
              </div>
            </div>
          ))
        }
      </div>
    </div>

    <!-- Download Resume CTA -->
    <div class="mt-16 lg:mt-24 text-center fade-in-up">
      <a
        href="/resume.pdf"
        download
        class="inline-flex items-center gap-4 bg-white border-4 border-black px-8 py-4 font-bold uppercase tracking-widest hover:bg-black hover:text-white transition-all duration-300 focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-black focus-visible:ring-offset-4"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
          ></path>
        </svg>
        Download Resume
      </a>
    </div>
  </div>
</section>

<script>
  function initTimeline() {
    // Animate timeline items on scroll
    const timelineObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("is-visible");
          }
        });
      },
      {
        threshold: 0.2,
        rootMargin: "0px 0px -100px 0px",
      }
    );

    document.querySelectorAll(".timeline-item").forEach((item) => {
      timelineObserver.observe(item);
    });

    // Animate timeline line on scroll
    const lineObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("is-drawing");
          }
        });
      },
      {
        threshold: 0.1,
      }
    );

    const timelineLine = document.querySelector(".timeline-line");
    if (timelineLine) {
      lineObserver.observe(timelineLine);
    }
  }

  // Initialize on load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initTimeline);
  } else {
    initTimeline();
  }

  // Reinitialize on page navigation
  document.addEventListener("astro:page-load", initTimeline);
</script>

<style>
  .timeline-item {
    opacity: 0;
    transform: translateY(30px);
    transition:
      opacity 0.6s ease-out,
      transform 0.6s ease-out;
  }

  .timeline-item.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .timeline-item[data-index="0"] {
    transition-delay: 0s;
  }

  .timeline-item[data-index="1"] {
    transition-delay: 0.1s;
  }

  .timeline-item[data-index="2"] {
    transition-delay: 0.2s;
  }

  .timeline-line {
    height: 0;
    transition: height 1.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .timeline-line.is-drawing {
    height: 100%;
  }

  .timeline-dot {
    opacity: 0;
    transform: scale(0);
    animation: dotAppear 0.4s ease-out forwards;
    animation-delay: 0.3s;
  }

  @keyframes dotAppear {
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .timeline-content {
    position: relative;
  }

  .timeline-content::before {
    content: "";
    position: absolute;
    top: 50%;
    width: 0;
    height: 2px;
    background: black;
    transform: translateY(-50%);
    transition: width 0.4s ease-out 0.3s;
  }

  @media (min-width: 1024px) {
    .timeline-item:nth-child(odd) .timeline-content::before {
      left: 100%;
      margin-left: 2rem;
    }

    .timeline-item:nth-child(even) .timeline-content::before {
      right: 100%;
      margin-right: 2rem;
    }

    .timeline-item.is-visible .timeline-content::before {
      width: 2rem;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .timeline-item,
    .timeline-line,
    .timeline-dot,
    .timeline-content::before {
      opacity: 1;
      transform: none;
      transition: none;
      animation: none;
      height: auto;
    }

    .timeline-item .timeline-content {
      transition: border-width 0.15s ease;
    }
  }

  @media (prefers-reduced-motion: no-preference) {
    .timeline-content:hover {
      transform: scale(1.02);
    }
  }
</style>

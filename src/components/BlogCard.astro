---
/**
 * BlogCard Component - Desktop Only (Refactored)
 *
 * Modular card component using shared utilities and sub-components
 * to reduce duplication while maintaining self-sufficiency.
 */

import OptimizedImage from "./OptimizedImage.astro";
import CardMetadata from "./CardMetadata.astro";
import CardContent from "./CardContent.astro";
import { getTagsByIds, type TagId } from "../config/tags";
import {
  getCardContainerClasses,
  getCardLinkClasses,
  getCardContentClasses,
  getImageContainerClasses,
  getActionClasses,
  getArrowIconClasses,
  getCardAriaLabel,
  isListLayout,
  type CardVariant,
} from "../utils/card-styles";

interface Props {
  title: string;
  excerpt: string;
  date: string;
  readTime: string;
  slug: string;
  tags?: TagId[];
  variant?: CardVariant;
  image?: string;
  imageAlt?: string;
  author?: string;
}

const {
  title,
  excerpt,
  date,
  readTime,
  slug,
  tags = [],
  variant = "list",
  image,
  imageAlt,
  author,
} = Astro.props;

const tagObjects = tags.length > 0 ? getTagsByIds(tags) : [];
const finalImageAlt = imageAlt || `${title} article cover image`;
const isListVariant = isListLayout(variant);
const ariaLabel = getCardAriaLabel(title, "article");
---

<article
  class={getCardContainerClasses(variant)}
  itemscope
  itemtype="https://schema.org/BlogPosting"
>
  <a
    href={`/writing/${slug}`}
    class={getCardLinkClasses(variant)}
    aria-label={ariaLabel}
  >
    {
      image && !isListVariant && (
        <div class={getImageContainerClasses(true)}>
          <OptimizedImage
            src={image}
            alt={finalImageAlt}
            width={1024}
            height={576}
            loading="lazy"
            class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
            aspectRatio="video"
          />
        </div>
      )
    }

    <div class={getCardContentClasses(variant)}>
      {
        !isListVariant && (
          <CardMetadata date={date} readTime={readTime} variant={variant} />
        )
      }

      {isListVariant && <CardMetadata date={date} variant="list" />}

      <CardContent
        title={title}
        description={excerpt}
        tags={tagObjects}
        variant={variant}
        readTime={isListVariant ? readTime : undefined}
      />

      {
        !isListVariant && (
          <span class={getActionClasses(variant)}>
            Read Article
            <svg
              class={getArrowIconClasses()}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              stroke-width="3"
              aria-hidden="true"
            >
              <path
                stroke-linecap="square"
                stroke-linejoin="miter"
                d="M17 8l4 4m0 0l-4 4m4-4H3"
              />
            </svg>
          </span>
        )
      }
    </div>

    {author && <meta itemprop="author" content={author} />}
    {image && <meta itemprop="image" content={image} />}
  </a>
</article>

<style>
  @media (prefers-reduced-motion: no-preference) {
    article a {
      transition:
        background-color 0.2s ease,
        color 0.2s ease;
    }

    article svg {
      transition: transform 0.2s ease;
    }
  }
</style>

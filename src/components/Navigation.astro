---
interface Props {
  currentPage?: "home" | "work" | "writing" | "profile";
}

const { currentPage } = Astro.props;

const links = [
  { href: "/profile", label: "Profile", page: "profile" },
  { href: "/work", label: "Work", page: "work" },
  { href: "/writing", label: "Writing", page: "writing" },
] as const;
---

<nav
  class="bg-white border-b-2 border-black sticky top-0 z-50 backdrop-blur-sm"
  aria-label="Main navigation"
>
  <div class="max-w-screen-2xl mx-auto px-8 md:px-16 lg:px-20 xl:px-32">
    <div class="h-20 md:h-24 flex justify-between items-center">
      <!-- Logo/Home Link -->
      <a
        href="/"
        class="text-xs md:text-sm font-bold tracking-[0.15em] uppercase hover:opacity-50 transition-opacity duration-200 focus-visible:opacity-50"
        aria-label={currentPage !== "home" ? "Go to home page" : "Home"}
      >
        {currentPage !== "home" ? "Home" : "Your Name"}
      </a>

      <!-- Desktop Navigation -->
      <ul
        class="hidden md:flex gap-6 md:gap-8 lg:gap-12 text-xs md:text-sm font-bold uppercase tracking-[0.15em]"
        role="list"
      >
        {
          links.map(({ href, label, page }) => (
            <li>
              <a
                href={href}
                class:list={[
                  "transition-opacity duration-200 focus-visible:opacity-100",
                  currentPage === page
                    ? "opacity-100"
                    : "opacity-50 hover:opacity-100",
                ]}
                aria-current={currentPage === page ? "page" : undefined}
              >
                {label}
              </a>
            </li>
          ))
        }
      </ul>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="md:hidden p-2 -mr-2 focus-visible:opacity-50"
        aria-label="Toggle menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="square"
            stroke-linejoin="miter"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div
      id="mobile-menu"
      class="hidden md:hidden border-t-2 border-black"
      role="dialog"
      aria-modal="true"
    >
      <ul class="py-6 md:py-8 space-y-4 md:space-y-6 text-sm font-bold uppercase tracking-[0.15em]">
        {
          links.map(({ href, label, page }) => (
            <li>
              <a
                href={href}
                class:list={[
                  "block py-2 transition-opacity duration-200",
                  currentPage === page
                    ? "opacity-100"
                    : "opacity-50 hover:opacity-100",
                ]}
                aria-current={currentPage === page ? "page" : undefined}
              >
                {label}
              </a>
            </li>
          ))
        }
      </ul>
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle with proper ARIA handling
  const button = document.getElementById("mobile-menu-button");
  const menu = document.getElementById("mobile-menu");

  if (button && menu) {
    button.addEventListener("click", () => {
      const expanded = button.getAttribute("aria-expanded") === "true";
      button.setAttribute("aria-expanded", String(!expanded));
      menu.classList.toggle("hidden");
    });

    // Close menu when clicking outside
    document.addEventListener("click", (e) => {
      if (
        !button.contains(e.target as Node) &&
        !menu.contains(e.target as Node)
      ) {
        button.setAttribute("aria-expanded", "false");
        menu.classList.add("hidden");
      }
    });

    // Close menu on escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !menu.classList.contains("hidden")) {
        button.setAttribute("aria-expanded", "false");
        menu.classList.add("hidden");
        button.focus();
      }
    });
  }
</script>

<style>
  /* Smooth mobile menu animation */
  @media (prefers-reduced-motion: no-preference) {
    #mobile-menu {
      animation: slideDown 0.2s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }
</style>

---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Navigation from "../../components/Navigation.astro";
import Footer from "../../components/Footer.astro";
import FilterBar from "../../components/FilterBar.astro";
import ProjectCard from "../../components/ProjectCard.astro";
import PageHeader from "../../components/PageHeader.astro";
import ContentList from "../../components/ContentList.astro";
import CapabilitiesSection from "../../components/CapabilitiesSection.astro";
import { getCollection } from "astro:content";
import { getTagsByIds, type TagId } from "../../config/tags";

const allPortfolioProjects = await getCollection("portfolio");

const projects = allPortfolioProjects
  .map((project) => {
    // project.id is the filename without extension
    const slug = project.id;
    return {
      title: project.data.title,
      description: project.data.description,
      year: project.data.year,
      tags: project.data.tags as TagId[],
      link: `/portfolio/${slug}`,
    };
  })
  .sort((a, b) => parseInt(b.year) - parseInt(a.year));

const allTags = getTagsByIds([...new Set(projects.flatMap((p) => p.tags))]);

const capabilities = [
  {
    title: "Design",
    items: [
      "Interface Design",
      "Design Systems",
      "Typography",
      "Visual Identity",
    ],
  },
  {
    title: "Development",
    items: [
      "Frontend Engineering",
      "Python / TypeScript",
      "Machine Learning",
      "Algorithm Design",
    ],
  },
  {
    title: "Strategy",
    items: [
      "Technical Architecture",
      "Problem Solving",
      "Research & Analysis",
      "Process Optimization",
    ],
  },
];
---

<BaseLayout title="Portfolio">
  <Navigation currentPage="portfolio" />

  <PageHeader
    title="Portfolio"
    description="Selected projects demonstrating technical expertise and design thinking"
  />

  <FilterBar tags={allTags} type="portfolio" />

  <ContentList>
    {
      projects.map((project, i) => (
        <div
          data-portfolio-item
          data-portfolio-tags={project.tags.join(",")}
          class:list={[i === projects.length - 1 && "border-b-0"]}
        >
          <ProjectCard
            title={project.title}
            description={project.description}
            year={project.year}
            tags={project.tags}
            link={project.link}
            variant="list"
          />
        </div>
      ))
    }
  </ContentList>

  <CapabilitiesSection capabilities={capabilities} />

  <Footer />
</BaseLayout>

---
/**
 * Work Index Page
 * 
 * Lists all work projects with filtering capabilities.
 * Features:
 * - Tag-based filtering
 * - Capabilities section
 * - Responsive grid layout
 */

import BaseLayout from "../../layouts/BaseLayout.astro";
import Navigation from "../../components/Navigation.astro";
import Footer from "../../components/Footer.astro";
import FilterBar from "../../components/FilterBar.astro";
import ProjectCard from "../../components/ProjectCard.astro";
import PageHeader from "../../components/PageHeader.astro";
import ContentList from "../../components/ContentList.astro";
import CapabilitiesSection from "../../components/CapabilitiesSection.astro";
import { getCollection } from "astro:content";
import { getTagsByIds, type TagId } from "../../config/tags";
import { PAGE_IDS } from "../../utils/constants";

/**
 * Fetch all work projects
 */
const allWorkProjects = await getCollection("work");

/**
 * Transform and sort projects by year (newest first)
 */
const projects = allWorkProjects
  .map((project) => {
    const slug = project.id; // In Astro 5, project.id is the filename without extension
    return {
      title: project.data.title,
      description: project.data.description,
      year: project.data.year,
      tags: project.data.tags as TagId[],
      link: `/work/${slug}`,
    };
  })
  .sort((a, b) => parseInt(b.year) - parseInt(a.year));

/**
 * Get all unique tags used across all projects
 */
const allTags = getTagsByIds([...new Set(projects.flatMap((p) => p.tags))]);

/**
 * Capabilities configuration
 */
const capabilities = [
  {
    title: "Design",
    items: [
      "Interface Design",
      "Design Systems",
      "Typography",
      "Visual Identity",
    ],
  },
  {
    title: "Development",
    items: [
      "Frontend Engineering",
      "Python / TypeScript",
      "Machine Learning",
      "Algorithm Design",
    ],
  },
  {
    title: "Strategy",
    items: [
      "Technical Architecture",
      "Problem Solving",
      "Research & Analysis",
      "Process Optimization",
    ],
  },
];
---

<BaseLayout title="Work">
  <Navigation currentPage={PAGE_IDS.WORK} />

  <PageHeader
    title="Work"
    description="Selected projects demonstrating technical expertise and design thinking"
  />

  <FilterBar tags={allTags} type="work" />

  <ContentList>
    {
      projects.map((project, i) => (
        <div
          data-work-item
          data-work-tags={project.tags.join(",")}
          class:list={[i === projects.length - 1 && "border-b-0"]}
        >
          <ProjectCard
            title={project.title}
            description={project.description}
            year={project.year}
            tags={project.tags}
            link={project.link}
            variant="list"
          />
        </div>
      ))
    }
  </ContentList>

  <CapabilitiesSection capabilities={capabilities} />

  <Footer />
</BaseLayout>

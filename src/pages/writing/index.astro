---
/**
 * Writing Index Page - Desktop Only
 */

import BaseLayout from "../../layouts/BaseLayout.astro";
import Navigation from "../../components/Navigation.astro";
import Footer from "../../components/Footer.astro";
import FilterBar from "../../components/FilterBar.astro";
import BlogCard from "../../components/BlogCard.astro";
import PageHeader from "../../components/PageHeader.astro";
import ContentList from "../../components/ContentList.astro";
import { getCollection } from "astro:content";
import { PAGE_IDS } from "../../utils/constants";
import {
  processWritingPosts,
  getUniqueTagsFromPosts,
} from "../../utils/content";
import { generateBlogStructuredData } from "../../utils/seo";

const allWritingPosts = await getCollection("writing");
const posts = processWritingPosts(allWritingPosts);
const allTags = getUniqueTagsFromPosts(posts);
const structuredData = generateBlogStructuredData(posts, Astro.site);
---

<BaseLayout
  title="Writing â€” Design, Technology & Creative Process"
  description="Thoughts on design, technology, and the creative process"
>
  <Navigation currentPage={PAGE_IDS.WRITING} />

  <main id="main-content">
    <PageHeader
      title="Writing"
      description="Thoughts on design, technology, and the creative process"
    />

    <FilterBar tags={allTags} type="writing" />

    <ContentList>
      {
        posts.map((post, i) => (
          <div
            data-writing-item
            data-writing-tags={post.tags.join(",")}
            class:list={[i === posts.length - 1 && "border-b-0"]}
          >
            <BlogCard
              title={post.title}
              excerpt={post.excerpt}
              date={post.date}
              readTime={post.readTime}
              slug={post.slug}
              tags={[...post.tags]}
              variant="list"
            />
          </div>
        ))
      }
    </ContentList>
  </main>

  <Footer />

  <script
    slot="head"
    type="application/ld+json"
    set:html={JSON.stringify(structuredData)}
    is:inline
  />
</BaseLayout>

<style>
  @media (prefers-reduced-motion: no-preference) {
    [data-writing-item] {
      transition: opacity 0.2s ease;
    }
  }
</style>
